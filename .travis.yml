language: r
cache: packages
dist: xenial

env:
  global:
    - ALLOWED_WARNINGS=0
    - ALLOWED_NOTES=0

before_install:
  - echo "options(repos = c(CRAN = 'https://packagemanager.rstudio.com/all/__linux__/xenial/latest'))" >> ~/.Rprofile.site
  - echo "options(HTTPUserAgent = paste0('R/', getRversion(), ' R (',
       paste(getRversion(), R.version['platform'], R.version['arch'], R.version['os']),
       ')'))" >> ~/.Rprofile.site

jobs:
  include:
  - r: devel
  - r: oldrel
  - r: release
    exclude:
      if: branch = master
  - r: release
    include:
      if: branch = master
    r_packages:
      - pkgdown
      - covr
    env: R_CURRENT=true
    deploy:
      provider: script
      script:
        - R CMD build . && Rscript -e 'pkgdown::deploy_site_github(verbose = TRUE, tarball = ".")'
        - Rscript -e 'covr::codecov()'
      cleanup: false
    after_success:
      - Rscript -e 'covr::codecov()'
      - Rscript -e 'inteRgrate::create_tag()'

script:
  - echo $TRAVIS_R_VERSION
  - Rscript -e 'remotes::install_local(".", upgrade = "never", build_vignettes = TRUE, force = TRUE)'
  - Rscript -e "inteRgrate::check_via_env(tag = FALSE, default = 'true')"

notifications:
  email:
    on_success: change
    on_failure: change
