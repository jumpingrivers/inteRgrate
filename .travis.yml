language: r
cache: packages
env:
  global:
    - ALLOWED_WARNINGS=0
    - ALLOWED_NOTES=0

r_packages:
  - covr
  - pkgdown

r:
#  - oldrel
  - release
#  - devel

script:
  - git remote rm origin
  - git remote add origin https://${GITHUB_PAT}@github.com/jumpingrivers/inteRgrate.git
  - git tag v0.1 -a -m "Version v0.1" || die "get error when add new tag"
  - git push origin v0.1
  - Rscript -e 'devtools::install(".", upgrade = "never", build_vignettes = TRUE)'
  - Rscript -e "inteRgrate::check_pkg(install = FALSE)"
  - Rscript -e "inteRgrate::check_r_filenames()"
  - Rscript -e "inteRgrate::check_tidy_description()"
  - Rscript -e "inteRgrate::check_lintr()"
  - Rscript -e "inteRgrate::check_namespace()"
  - Rscript -e "inteRgrate::check_version()"

notifications:
  email:
    on_success: change
    on_failure: change

deploy:
  provider: script
  script: Rscript -e 'pkgdown::deploy_site_github()'
  skip_cleanup: true

## Only run covr on release
#after_success:
#  - Rscript -e "if(length(grep('1\$', ${TRAVIS_JOB_NUMBER}))) covr::codecov()";



